# 更新日志

本文档记录项目的所有重要变更。

## [8.0.0] - 2025-12-10

### 新增功能
- **自动计算速度列**：速度列现在像单价 (RMB/km) 一样自动计算且只读。
- **扩展排序功能**：为车次/航班号、站点、城市、座席/舱位、车型/航空公司、铁路局/机型列添加了排序功能。
- **铁路局与航空公司图表**：新增柱状图，显示按铁路局（火车模式）或航空公司（飞机模式）统计的次数。
- **车型与机型图表**：新增图表，显示按车型或机型统计的次数分布。
- **未知值高亮显示**：在铁路局和车型图表中，"未知"值用红色高亮，提升可见性。
- **重新画线按钮**：在操作菜单中添加"🔄 重新画线"按钮，可强制重新生成路径，可能产生不同的曲线外观。

### 功能改进
- **字段映射优化**：航空公司图表现在正确地按航空公司（而非机型）聚合飞机模式的数据。
- **列组织优化**：速度列作为只读字段正确集成，支持自动更新。

### 问题修复
- **备注字段 Bug**：修复了编辑记录时备注字段被 km/h 数据填充的问题。
- **初始加载高亮**：修复了初始页面加载时统计卡片点击滚动功能，通过确保正确分配 `tr._record` 实现。

## [7.0.0] - 2025-12-09

### 新增功能
- **年度总结筛选**：查看年度总结时，所有面板完全按年份筛选。
  - 所选年份的月度统计图表（柱状图）。
  - 按年份筛选的路线热力图和城市排名。
  - 仅显示所选年份记录的数据表格。
  - 地图图例自动选择指定年份。
  - 地图路径仅显示所选年份的路线。
- **增强模态窗口体验**：在首页和管理页面的功能说明模态窗口中添加 ESC 键支持。
- **首页功能文档**：在首页侧边栏添加了全面的功能说明模态窗口。

### 功能改进
- **年份图例行为**：在年份筛选模式下，图例复选框现在被禁用并带有视觉指示器。
- **统计面板一致性**：统一了年度总结和历史总结面板的布局（4x3 网格，包含总计/平均/记录）。

### 问题修复
- **地图路径筛选**：解决了切换到年份筛选模式时所有路径仍然可见的问题。
- **状态恢复**：修复了切换回历史总结标签时地图路径可见性的恢复问题。

## [6.0.0] - 2025-12-04

### 新增功能
- **Gemini 问答**：集成 Google Gemini AI 进行智能旅行数据分析和问答。
- **年度报告**：自动生成带图表的年度旅行总结。
- **云端同步**：使用云端 bin 实现跨设备数据同步。
- **双向路线分离**：改进地图可视化，防止 A→B 和 B→A 路线重叠。
- **随机曲线方向**：为更自然的地图美观效果添加伪随机曲线方向。
- **动画增强**：更流畅的回放，带"三个点"加载指示器和 ESC 键支持。
- **帮助文档**：结构化功能指南的全面帮助模态窗口。

### 功能改进
- **文件结构**：将 `index_dev.html` 重命名为 `index.html`，`home.html` 重命名为 `dashboard.html`。
- **侧边栏布局**：重新排列侧边栏项目，以更好地访问智能功能。
- **地图交互**：优化地图重绘逻辑以减少闪烁。
- **API 配置**：将所有 API 密钥和端点集中在 `js/config.js` 中。

### 问题修复
- **主题一致性**：修复了模态窗口和地图样式中的暗色模式问题。
- **路线重叠**：解决了双向行程的视觉重叠问题。
